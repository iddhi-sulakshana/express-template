paths:
  /auth/token/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh and rotate access token using refresh token
      description: |
        Refresh an expired access token and rotate the refresh token for enhanced security.
        This endpoint validates the refresh token from the Authorization header, checks user status, and issues new token pair.

        **Security Implementation**:
        - Refresh token provided via Authorization header (Bearer token)
        - Refresh tokens are rotated on each use (old token becomes invalid)
        - User status validation ensures only active users can refresh tokens
        - Both new access token and new refresh token are returned
        - Rate limiting will be implemented (TODO)
      operationId: refreshAccessToken
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tokens refreshed and rotated successfully
          headers:
            x-access-token:
              description: New JWT access token for API authentication
              schema:
                type: string
              example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCIsInVzZXJUeXBlIjoiQ1VTVE9NRVIiLCJ1c2VyU3RhdHVzIjoiQUNUSVZFIiwiaWF0IjoxNzM0NTY3ODkwLCJleHAiOjE3MzQ2NzQyOTB9.newAccessToken'
            x-refresh-token:
              description: New JWT refresh token (old one is now invalid)
              schema:
                type: string
              example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCIsInNpZCI6InNlc3Npb25faWQiLCJyaWQiOiJuZXdfcmVmcmVzaF9pZCIsInJvdCI6MSwiaWF0IjoxNzM0NTY3ODkwLCJleHAiOjE3MzQ2NzQyOTB9.newRefreshToken'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenSuccessResponse'
              examples:
                success_response:
                  summary: Successful token refresh and rotation
                  value:
                    status: 200
                    message: 'Refresh token rotated successfully'
                    data: 'Success'
        '400':
          description: Bad request - Missing or invalid Authorization header
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                missing_header:
                  summary: Missing Authorization header
                  value:
                    status: 400
                    message: 'Validation error'
                    data:
                      - path: 'authorization'
                        message: 'Authorization header is required'
                        code: 'missing_header'
        '401':
          description: Unauthorized - Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnauthorizedError'
              examples:
                invalid_token:
                  summary: Invalid refresh token
                  value:
                    status: 401
                    message: 'Invalid refresh token'
        '404':
          description: User not found or user account not active
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
              examples:
                user_not_found:
                  summary: User not found or inactive
                  value:
                    status: 404
                    message: 'User not found'
        '422':
          description: Validation error - Header validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                zod_validation_error:
                  summary: Zod validation error
                  value:
                    status: 422
                    message: 'Validation error'
                    data:
                      - path: 'authorization'
                        message: 'Authorization header is required'
                        code: 'invalid_type'

components:
  schemas:
    RefreshTokenSuccessResponse:
      type: object
      properties:
        status:
          type: integer
          description: HTTP status code
          example: 200
        message:
          type: string
          description: Success message indicating token rotation
          example: 'Refresh token rotated successfully'
        data:
          type: string
          description: Success indicator
          example: 'Success'

    ValidationError:
      type: object
      properties:
        status:
          type: integer
          example: 400
        message:
          type: string
          example: 'Validation error'
        data:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
                description: Field path with validation error
                example: 'authorization'
              message:
                type: string
                description: Validation error message
                example: 'Authorization header is required'
              code:
                type: string
                description: Validation error code
                example: 'missing_header'

    UnauthorizedError:
      type: object
      properties:
        status:
          type: integer
          example: 401
        message:
          type: string
          example: 'Invalid refresh token'

    NotFoundError:
      type: object
      properties:
        status:
          type: integer
          example: 404
        message:
          type: string
          example: 'User not found'

tags:
  - name: Authentication
    description: JWT token refresh, rotation, and management operations
